DO $$
DECLARE
    -- IDs predeterminados para termos um controle perfeito na hora de deletar
    v_company_ids UUID[] := ARRAY[
        'c0000000-0000-4000-a000-000000000001'::uuid, 'c0000000-0000-4000-a000-000000000002'::uuid,
        'c0000000-0000-4000-a000-000000000003'::uuid, 'c0000000-0000-4000-a000-000000000004'::uuid,
        'c0000000-0000-4000-a000-000000000005'::uuid, 'c0000000-0000-4000-a000-000000000006'::uuid,
        'c0000000-0000-4000-a000-000000000007'::uuid, 'c0000000-0000-4000-a000-000000000008'::uuid,
        'c0000000-0000-4000-a000-000000000009'::uuid, 'c0000000-0000-4000-a000-000000000010'::uuid
    ];
    v_user_ids UUID[] := ARRAY[
        'c0000000-0000-4000-a000-000000000011'::uuid, 'c0000000-0000-4000-a000-000000000012'::uuid,
        'c0000000-0000-4000-a000-000000000013'::uuid, 'c0000000-0000-4000-a000-000000000014'::uuid,
        'c0000000-0000-4000-a000-000000000015'::uuid, 'c0000000-0000-4000-a000-000000000016'::uuid,
        'c0000000-0000-4000-a000-000000000017'::uuid, 'c0000000-0000-4000-a000-000000000018'::uuid,
        'c0000000-0000-4000-a000-000000000019'::uuid, 'c0000000-0000-4000-a000-000000000020'::uuid
    ];
    v_customer_ids UUID[] := ARRAY[
        'cc000000-0000-4000-a000-000000000001'::uuid, 'cc000000-0000-4000-a000-000000000002'::uuid,
        'cc000000-0000-4000-a000-000000000003'::uuid, 'cc000000-0000-4000-a000-000000000004'::uuid,
        'cc000000-0000-4000-a000-000000000005'::uuid, 'cc000000-0000-4000-a000-000000000006'::uuid,
        'cc000000-0000-4000-a000-000000000007'::uuid, 'cc000000-0000-4000-a000-000000000008'::uuid,
        'cc000000-0000-4000-a000-000000000009'::uuid, 'cc000000-0000-4000-a000-000000000010'::uuid
    ];
    i INT;
    names TEXT[] := ARRAY['Tech Alpha', 'Beta Solutions', 'Gamma Servicos', 'Delta Engenharia', 'Epsilon TI', 'Zeta Consultoria', 'Eta Manutencao', 'Theta Telecom', 'Iota Sistemas', 'Kappa Redes'];
BEGIN
    FOR i IN 1..10 LOOP
        -- 1. Cria a Empresa
        INSERT INTO public.companies (id, name, trade_name, corporate_name, document, email, phone, city, plan)
        VALUES (
            v_company_ids[i], names[i], names[i], names[i] || ' LTDA',
            '00.000.000/000' ||(i % 10)|| '-00', 'contato@' || lower(replace(names[i], ' ', '')) || '.com.br',
            '(11) 90000-000' ||(i % 10), 'São Paulo/SP', 'MENSAL'
        );

        -- 2. Cria o Usuário da Empresa no Supabase Auth (para conseguir logar)
        INSERT INTO auth.users (instance_id, id, aud, role, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data, is_super_admin, is_sso_user)
        VALUES (
            '00000000-0000-0000-0000-000000000000', v_user_ids[i], 'authenticated', 'authenticated',
            'admin@' || lower(replace(names[i], ' ', '')) || '.com.br',
            '$2a$10$wU05.Gf3Tq0z.x70yvWj3.xG1hXXjGgT4Zk9C/3tY8G9xXX/19mF.', -- Autogalido de "senha123" criptografada
            now(), now(), now(), '{"provider": "email", "providers": ["email"]}',
            '{"name": "Admin ' || names[i] || '"}', false, false
        );

        -- 3. Atualiza os dados na tabela public.users (criada via Trigger automático do Supabase)
        UPDATE public.users 
        SET company_id = v_company_ids[i],
            role = 'Administrador',
            password = 'senha123',
            phone = '(11) 98888-000' ||(i % 10)
        WHERE id = v_user_ids[i];

        -- 4. Cria o Cliente base dentro da empresa (Customer final)
        INSERT INTO public.customers (id, company_id, name, phone, city, address)
        VALUES (
            v_customer_ids[i], v_company_ids[i], 'Cliente Demo da ' || names[i], '(11) 97777-000' ||(i % 10), 'São Paulo/SP', 'Rua Exemplo, ' || i
        );

        -- 5. Lança 2 Ordens de Serviço por empresa
        INSERT INTO public.service_orders (company_id, customer_id, tech_id, type, description, status)
        VALUES 
            (v_company_ids[i], v_customer_ids[i], v_user_ids[i], 'Instalação', 'Serviço de instalação de infraestrutura', 'Aberta'),
            (v_company_ids[i], v_customer_ids[i], v_user_ids[i], 'Manutenção', 'Manutenção preventiva e corretiva', 'Em Andamento');
            
    END LOOP;
END $$;
