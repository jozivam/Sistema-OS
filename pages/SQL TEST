-- SQL TEST DATA FOR COMPANY: pamonha (2f193dc6-1615-4131-a9be-5b4b7673b840)

-- 1. Inserir Técnicos (Users)
-- Corrigido: Removida a coluna 'city' que não existe na tabela users
INSERT INTO public.users (id, company_id, name, email, phone, role, is_blocked, password)
VALUES 
  (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Carlos Técnico', 'carlos@pamonha.com', '(11) 91111-1111', 'Técnico', false, '123456'),
  (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Ana Suporte', 'ana@pamonha.com', '(11) 92222-2222', 'Técnico', false, '123456'),
  (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Marcos Reparos', 'marcos@pamonha.com', '(11) 93333-3333', 'Técnico', false, '123456');

-- 2. Inserir Clientes (Customers)
-- Usaremos uma CTE para capturar os IDs dos clientes para as ordens de serviço
WITH new_customers AS (
  INSERT INTO public.customers (id, company_id, name, phone, city, address, number, sector, notes)
  VALUES 
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'João Silva', '(11) 98888-0001', 'Araguaína', 'Rua das Flores', '10', 'Centro', 'Cliente VIP'),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Maria Oliveira', '(11) 98888-0002', 'Araguaína', 'Av. Brasil', '500', 'Setor Sul', 'Portão eletrônico com senha'),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Pedro Santos', '(11) 98888-0003', 'Araguaína', 'Rua 7', '123', 'Setor Norte', NULL),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Lucia Ferreira', '(11) 98888-0004', 'Araguaína', 'Rua Tupi', '45', 'Bairro Novo', 'Ligar antes de ir'),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Ricardo Souza', '(11) 98888-0005', 'Araguaína', 'Av. JK', '1000', 'Industrial', NULL),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Fernanda Lima', '(11) 98888-0006', 'Araguaína', 'Rua C', '88', 'Residencial', NULL),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Roberto Costa', '(11) 98888-0007', 'Araguaína', 'Rua Mato Grosso', '12', 'Centro', NULL),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Juliana Mello', '(11) 98888-0008', 'Araguaína', 'Alameda das Palmeiras', '2', 'Jardins', NULL),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Bruno Alves', '(11) 98888-0009', 'Araguaína', 'Rua Principal', '55', 'Setor Oeste', NULL),
    (gen_random_uuid(), '2f193dc6-1615-4131-a9be-5b4b7673b840', 'Dandara Paz', '(11) 98888-0010', 'Araguaína', 'Rua da Paz', '101', 'Setor Leste', NULL)
  RETURNING id
),
tech_ids AS (
  SELECT id FROM public.users WHERE company_id = '2f193dc6-1615-4131-a9be-5b4b7673b840' AND role = 'Técnico'
)
-- 3. Inserir Ordens de Serviço (Service Orders)
INSERT INTO public.service_orders (
  id, company_id, customer_id, tech_id, type, description, status, scheduled_date, created_at
)
SELECT 
  gen_random_uuid(), 
  '2f193dc6-1615-4131-a9be-5b4b7673b840', 
  c.id, 
  (SELECT id FROM tech_ids ORDER BY RANDOM() LIMIT 1),
  (ARRAY['Manutenção', 'Instalação', 'Reparo', 'Suporte'])[floor(random() * 4 + 1)],
  'Serviço de teste gerado automaticamente para o cliente.',
  (ARRAY['ABERTA', 'EM_ANDAMENTO', 'PAUSADA'])[floor(random() * 3 + 1)],
  CURRENT_DATE + (floor(random() * 7)::int),
  NOW() - (random() * interval '30 days')
FROM new_customers c;
